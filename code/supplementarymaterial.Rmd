---
title: "Supplementary material: Animal diversity and ecosystem functioning in dynamic food webs"
author:
- name: Florian D. Schneider \footnotemark[1] \footnotemark[2] \footnotemark[4] \footnotemark[5]
- name: Ulrich Brose \footnotemark[2] \footnotemark[3]
- name: Björn C. Rall \footnotemark[2] \footnotemark[3]
- name: Christian Guill \footnotemark[2] \footnotemark[6] \footnotemark[7]
output:
  pdf_document:
    fig_caption: yes
    fig_crop: no
    fig_height: 6
    fig_width: 9
    template: si.template 
  word_document:
    fig_caption: yes
    fig_width: 6
  html_document:
    fig_caption: yes
    fig_width: 4
    highlight: null
    keep_md: yes
    theme: united
csl: nature.csl
bibliography: biblio.bib

---


\renewcommand{\thefootnote}{\fnsymbol{footnote}}   
\footnotetext[1]{Corresponding author: florian.schneider@univ-montp2.fr }
\footnotetext[2]{Systemic Conservation Biology, J.F. Blumenbach Institute of Zoology \& Anthropology, University of Göttingen, Berliner Str. 28, 37073 Göttingen, Germany}
\footnotetext[3]{German Centre for Integrative Biodiversity Research (iDiv) Halle-Jena-Leipzig, Deutscher Platz 5e, 04103 Leipzig, Germany}
\footnotetext[4]{Institut des Sciences de l'Evolution, Université Montpellier, CNRS, IRD, UMR 5554, C.C.065,  34095 Montpellier Cedex 05, France}
\footnotetext[5]{Senckenberg Biodiversity and Climate Research Centre (BiK-F), Senckenberganlage 25, 60325 Frankfurt am Main, Germany}
\footnotetext[6]{Institute of Biochemistry and Biology, University of Potsdam, Potsdam, Germany}
\footnotetext[7]{Institute for Biodiversity and Ecosystem Dynamics, University of Amsterdam, P.O. Box 94248, 1090 GE Amsterdam, The Netherlands \newline \newline The authors declare that they contributed to the present work as follows: FDS, UB, BCR, and CG designed the simulation experiment; CG and FDS developed the simulation code; FDS, UB, BCR, and CG wrote the paper.}


\newpage


```{r, echo = FALSE, warning=FALSE}


webstats <- read.table("../data/webstats.txt", sep = ",")

output <- list()

source("../code/analyse.r")


  longtick = -0.06
  shorttick = -0.03
  par(cex.lab = 1.5)
  
  x <- seq(1,95,length = 100)

```



```{r, echo = FALSE, fig.width = 3, fig.height = 6, dev = 'png', dpi = 300, fig.cap='average body size of animals and plants.', fig.pos = "!h", out.width = "2in", warning=FALSE}


par(mfcol = c(2,1))
par( mar = c(3,4,0.5,1)+.1, oma = c(1,0,1,0), las = 1, lend = 1)

analyse(webstats$S_c_fin, webstats$Mav_c, ylab = "Animal body mass", modeltype = "log", plotting = TRUE, ylim = quantile(webstats$Mav_c, c(0.02,0.975)) )

axis(2, at = 10^c(2,3,4),labels = c(expression(10^{2}),expression(10^{3}),expression(10^4)),  tck = longtick, las = 1)
axis(2, at = c(seq(10^2,10^3, length = 10), seq(10^3,10^4, length = 10) ), tck =shorttick, labels = NA)


analyse(webstats$S_c_fin, webstats$Mav_b, ylab = "Plant body mass", modeltype = "log", ylim = quantile(webstats$Mav_b, c(0.025,0.975)))
axis(1, at = c(0,50,100), tck = longtick)
axis(1, at = seq(0,100, 10), tck = shorttick, labels = NA)

axis(2, at = 10^c(0,1,2),labels = c(expression(10^{0}),expression(10^{1}),expression(10^2)),  tck = longtick, las = 1)
axis(2, at = rep(seq(1,10, length = 10), times = 2)*rep(10^(0:1), each = 10), 
     tck =shorttick, labels = NA)


```




# Sensitivity analysis

```{r, echo=FALSE, warning=FALSE}

sensitivity <- function(x, values, data = webstats, modeltype = "log") {
     
  data$variable <- x
  
  output <- list()
  if(modeltype == "log") {
    
  output[[1]] <- lm( log(meanB_c) ~ log(S_c_fin)*variable, data = data )
  output[[2]] <- lm( log(meanB_b) ~ log(S_c_fin)*variable, data = data )
  output[[3]] <- lm( log(cons_igp) ~ log(S_c_fin)*variable, data = subset(data, cons_igp != 0) )
  output[[4]] <- lm( log(bas_cons) ~ log(S_c_fin)*variable, data = data )
  output[[5]] <- lm( log(cons_resp) ~ log(S_c_fin)*variable, data = data )
  output[[6]] <- lm( log(bas_resp) ~ log(S_c_fin)*variable, data = data )
  
  }
  
  if(modeltype == "logit") {
    
  output[[1]] <- lm( log(meanB_c) ~ boot::logit(S_c_fin)*variable, data = data )
  output[[2]] <- lm( log(meanB_b) ~ boot::logit(S_c_fin)*variable, data = data )
  output[[3]] <- lm( log(cons_igp) ~ boot::logit(S_c_fin)*variable, data = subset(data, cons_igp != 0) )
  output[[4]] <- lm( log(bas_cons) ~ boot::logit(S_c_fin)*variable, data = data )
  output[[5]] <- lm( log(cons_resp) ~ boot::logit(S_c_fin)*variable, data = data )
  output[[6]] <- lm( log(bas_resp) ~ boot::logit(S_c_fin)*variable, data = data )
  
  }
  
    
  if(modeltype == "gam") {
    
  output[[1]] <- lm( log(meanB_c) ~ boot::logit(S_c_fin)*variable, data = data )
  output[[2]] <- lm( log(meanB_b) ~ boot::logit(S_c_fin)*variable, data = data )
  output[[3]] <- lm( log(cons_igp) ~ boot::logit(S_c_fin)*variable, data = subset(data, cons_igp != 0) )
  output[[4]] <- lm( log(bas_cons) ~ boot::logit(S_c_fin)*variable, data = data )
  output[[5]] <- lm( log(cons_resp) ~ boot::logit(S_c_fin)*variable, data = data )
  output[[6]] <- lm( log(bas_resp) ~ boot::logit(S_c_fin)*variable, data = data )
  
  }
  
  par( mar = c(5,3,0.5,1)+.1, oma = c(4,4,2,0), las = 1, lend = 1, bty = "n")
  layout(matrix(c(1:6), ncol = 3, byrow = F))


  longtick = -0.06
  shorttick = -0.03
  par(cex.lab = 1.5)
  
  x <- seq(1,90,length = 100)

  
  # a) Predator biomass
  analyse(webstats$S_c_fin, webstats$meanB_c, equation = FALSE, ylab = "", plotmodel = TRUE, modeltype = modeltype)
  
  for( i in values) {
  y <- exp(predict(output[[1]], newdata = list(S_c_fin = x, variable = rep(i,length(x))  )))
    lines(x, y , col = "red2", lty = 2)
    text(tail(x,1), tail(y,1), round(i, 2), col = "red2", pos = 4)
  }

   axis(2, at = 10^c(0,1,2), labels = c( 1, 10,100), tck = longtick, las = 1)
  axis(2, at = (rep(10^seq(0, 1, 1), each = 10) * seq(1,10, 1)), labels = NA, tck = shorttick)
   mtext("animal biomass", las = 0, padj = -3,side = 2)
 
  # b) Basal biomass
  analyse(webstats$S_c_fin, webstats$meanB_b, equation = FALSE, ylab = "", plotmodel = TRUE, modeltype = modeltype)
    
 
  for( i in values) {
  y <- exp(predict(output[[2]], newdata = list(S_c_fin = x, variable = rep(i,length(x))  )))
    lines(x, y , col = "red2", lty = 2)
    text(tail(x,1), tail(y,1), round(i, 2), col = "red2", pos = 4)
  }


  axis(1, at = c(0,50,100), tck = longtick)
  axis(1, at = (seq(0,100, 10)), tck = shorttick, labels = NA)
  
  axis(2, at = 10^(1:2), labels = c( 10,100), tck = longtick, las = 1)
  axis(2, at = (rep(10^seq(1, 1, 1), each = 10) * seq(1,10, 1)), labels = NA, tck = shorttick)
  mtext("plant biomass", las = 0, padj = -3, side = 2)
  
  
  # c) intra guild predation
  analyse(webstats$S_c_fin[webstats$cons_igp != 0], webstats$cons_igp[webstats$cons_igp != 0], ylab = "", equation = FALSE , plotmodel = TRUE, modeltype = modeltype)
 #analyse(webstats$S_c_fin, (webstats$cons_igp+1), ylab = "", equation = FALSE )
 
  for( i in values) {
  y <- exp(predict(output[[3]], newdata = list(S_c_fin = x, variable = rep(i,length(x))  )))
    lines(x, y , col = "red2", lty = 2)
    text(tail(x,1), tail(y,1), round(i, 2), col = "red2", pos = 4)
  }

 axis(2, at = 10^seq(-4,0,2), labels = c(expression(10^{-4}),expression(10^{-2}),expression(10^0)), tck = longtick, las = 1)
  #axis(2, at = 10^seq(-4,0,2),labels = c("0.0001","0.01","1"), tck = longtick, las = 1)
  axis(2, at = (rep(10^seq(-4, -1, 1), each = 10) * seq(1,10, 1)), labels = NA, tck = shorttick)
  mtext("intraguild predation", las = 0, padj = -3, side = 2)
  
  # d) total consumption on basal
  analyse(webstats$S_c_fin, webstats$bas_cons, equation = FALSE, ylab = "", plotmodel = TRUE, modeltype = modeltype)
  
 
  for( i in values) {
  y <- exp(predict(output[[4]], newdata = list(S_c_fin = x, variable = rep(i,length(x))  )))
    lines(x, y , col = "red2", lty = 2)
    text(tail(x,1), tail(y,1), round(i, 2), col = "red2", pos = 4)
  }

  axis(1, at = c(0,50,100), tck = longtick)
  axis(1, at = (seq(0,100, 10)), tck = shorttick, labels = NA)
   
   axis(2, at = 10^c(-1:0), labels = c(0.1, 1), tck = longtick, las = 1)
  axis(2, at = c(seq(0.1,1, 0.1), seq(1,5, 1) ), tck =shorttick, labels = NA)
  mtext("consumption on plants", las = 0, padj = -3, side = 2)
  
  
  # e) Predator respiration
  analyse(webstats$S_c_fin, webstats$cons_resp,equation = FALSE,  ylab = "", plotmodel = TRUE, modeltype = modeltype)
 
  for( i in values) {
  y <- exp(predict(output[[5]], newdata = list(S_c_fin = x, variable = rep(i,length(x))  )))
    lines(x, y , col = "red2", lty = 2)
    text(tail(x,1), tail(y,1), round(i, 2), col = "red2", pos = 4)
  }

  axis(2, at = 10^c(-1:0), labels = c(0.1,1),tck = longtick, las = 1)
  axis(2, at = c(seq(.05,0.1, 0.01),seq(.1,1, length = 10)), tck = shorttick , labels = NA)
  mtext("animal respiration", las = 0, padj = -3, side = 2)
  
  # f) Basal respiration
  analyse(webstats$S_c_fin, webstats$bas_resp,equation = FALSE,  ylab = "", plotmodel = TRUE, modeltype = modeltype) # ylim = exp(c(-0.51,1)),
  
  for( i in values) {
  y <- exp(predict(output[[6]], newdata = list(S_c_fin = x, variable = rep(i,length(x))  )))
    lines(x, y , col = "red2", lty = 2)
    text(tail(x,1), tail(y,1), round(i, 2), col = "red2", pos = 4)
  }

  axis(1, at = c(0,50,100), tck = longtick)
  axis(1, at = (seq(0,100, 10)), tck = shorttick, labels = NA)
   
   axis(2, at = 10^c(-1:0), labels = c(0.1, 1), tck = longtick, las = 1)
  axis(2, at = c( seq(0.1,1, 0.1), seq(1,5,1)), tck = shorttick , labels = NA)
  mtext("plant respiration", las = 0, padj = -3, side = 2)
  


mtext("animal species richness", side = 1, outer = TRUE)
}

```


This series of complementary analyses tests if the conclusions we draw in the paper are robust to changes in the model parameters.

## Stochastic parameters 

In the article, we argue for the parameters we applied for allometric constants or optimal body mass scaling based on empirical evidence but included stochastic noise to cover uncertainties about the precise values. Here, we analyse how changes in those parameter values affect the resulting relationship between species richness and the ecosystem process, $y$, by fitting linear models that contain the parameter in question, $x$, as well as it's interaction term with $S_A$.

(@lm) $$ \log{y} = \log(a) + \alpha \log(S_A) + \beta X + \gamma X \log(S_a) $$ 

We illustrate the relative importance of those parameters by reproducing figure 4 from the manuscript with the linear model predictions for lowest and highest parameter values. The lowest and highest values are defined by the 99%-interquantile of the parameter range, i.e. the parameter threshold values that incorporate 99% of all replicates. The full code for the sensitivity analyses is available online at https://github.com/fdschneider/schneider_et_al_2016_animaldiversity. 

### Hill-exponent

The Hill-exponent of the functional response varies around 1.5 with a standard deviation of 0.2. This is based on the frequent observation of weak type-III functional responses in natural systems [@rall12; @englund11]. For reasons of simplicity, we assume a unified type of functional response in each habitat. This reflects the reduction of capture coefficients at very low resource densities depends on the habitat heterogeneity.   
In natural ecosystems, the shape of the sigmoidal functional response will differ among taxa, but might vary systematically with body size ratio [@kalinkat13]. 

The value of the Hill-exponent did not alter the relationship between functional diversity and ecosystem functions qualitatively (Fig. S2). 
A strong sigmoidal shape of functional response (i.e. high Hill-exponents) reduced average animal biomass. This reduction in animal biomass propagated to plant biomass accopanied by an increase in plant respiration (Fig. S2). 

```{r, echo = FALSE, dev = 'png', dpi = 300, fig.cap='effect of Hill-exponent on relationship between FD and ecosystem functions. Solid line is overall model; dashed lines are covering 99% of variation in Hill-exponent. '}

sensitivity(webstats$hill,  quantile(webstats$hill, c(0.005,0.995)))

```


### Capture coefficient

The allometric feeding rate model includes a definition of the capture coefficient, $b_\mathit{ij}$ that scales the feeding efficiency $\mathcal{L}_{i\,,j}$ with the body mass of consumer, $m_i$, and the body mass of the resource, $m_j$, following power-law relationships. <!--: 

(@capture) $$ b_\mathit{ij}=b_0 m_i^{\beta_i} m_j^{\beta_j} \mathcal{L}_{i\,,j}\,. $$
--> 
For each food web, the exponent of consumer body mass was drawn from a normal distribution with $\mu = ?$, $\sigma = ?$. The exponent of resource body mass was drawn from a normal distribution with $\mu = ?$, $\sigma = ?$. Those means were estimated from empirically observed values [@rall12]. For plant resources, the capture coefficient did not scale with resource body mass and was set to $\beta_j = 0$. 

The exponent of consumer body mass had a prominent, turning the effect of animal species richness on total plant biomass positive at low values and negative at high values (Fig. S3). Other ecosystem functions responded only weakly to changes in the exponent of consumer body mass. 
The influence of the exponent of resource body mass was weak (Fig. S4) and did not alter the relationship  between functional diversity and ecosystem functioning qualitatively. 

```{r, echo = FALSE, dev = 'png', dpi = 300, fig.cap='effect of exponent of consumer body mass, $\\beta_i$, in attack rate on relationship between FD and ecosystem functions. Solid line is overall model; dashed lines are covering 99% of variation in $\\beta_i$.'}

sensitivity(webstats$a_c, quantile(webstats$a_c, c(0.005, 0.995)))

```

```{r, echo = FALSE, dev = 'png', dpi = 300, fig.cap='effect of exponent of resource body mass, $\\beta_j$, in attack rate on relationship between FD and ecosystem functions. Solid line is overall model; dashed lines are covering 99% of variation in $\\beta_j$.'}

sensitivity(webstats$a_p, quantile(webstats$a_p, c(0.005,0.995)))

```

### Consumer interference

We assumed that consumers of the same species engaged in non-fatal interactions that reduced their time dedicated to foraging as their own density increased. The value of predator interference was drawn from a normal distribution with $\mu = ?$ and $\sigma = ?$.  The effect of predator interference was negligible and did not alter the relationship between functional diversity and ecosystem functioning (Fig. S5). 

```{r, echo = FALSE, dev = 'png', dpi = 300, fig.cap='effect of predator interference, $c$, on relationship between FD and ecosystem functions. Solid line is overall model; dashed lines include 99% of variation in $c$.'}

sensitivity(webstats$pred_int, quantile(webstats$pred_int, c(0.005,0.995)) )

```


### Handling time

The time a consumer spends on handling one prey item is a power-law of both consumer body mass, $m_i$, and resource body mass, $m_j$.
<!--
(@handling) $$h_i=h_0 m_i^{\eta_i} m_j^{\eta_j}\,,$$
-->
Neither of the two exponents alters the relationship between functional diversity and ecosystem functioning (Fig. S6 & S7).  

```{r, echo = FALSE, dev = 'png', dpi = 300,  fig.cap='effect of exponent of consumer body mass, $\\eta_i$, in handling time on relationship between FD and ecosystem functions. Solid line is overall model; dashed lines are covering 99% of variation in $\\eta_i$.'}

sensitivity(webstats$h_c, quantile(webstats$h_c, c(0.005,0.995)))

```


```{r, echo = FALSE,dev = 'png', dpi = 300, fig.cap='effect of exponent of resource body mass, $\\eta_i$, in handling time on relationship between FD and ecosystem functions. Solid line is overall model; dashed lines are covering 99% of variation in $\\eta_j$.'}

sensitivity(webstats$h_p, quantile(webstats$h_p, c(0.005,0.995)))

```


## Structural parameters

Other parameters of the model were of structural character, such as the number of basal plant species or the type and amount of nutrient supply. To show how changes in those parameters alter the relationship of biodiversity and ecosystem function we performed additional simulations. For each alternative parameter value, we ran 400 simulations along the gradient of 10 to 100 animal species and fitted independent linear models for each simulation on log-log transformed data. 

```{r, echo = FALSE}

sensitivity_add <- function(response, data, label, 
                          col = "#00FFFF",  
                          x = seq(1,90,length = 100), 
                          modeltype = "log", 
                          addpoints = TRUE, 
                          ...) {

  if("log" %in% modeltype) {
    model <- lm( log(data[,response]) ~ log(S_c_fin), data = data )
  }

  if("logit" %in% modeltype) {
    model <- lm( log(data[,response]) ~ boot::logit(S_c_fin)*variable, data = data )
  }
    
  if("gam" %in% modeltype) {
    model <- lm( log(data[,response]) ~ boot::logit(S_c_fin)*variable, data = data )
  }

  if(addpoints) {
    points(data[,response] ~ data$S_c_fin, pch = 20, cex = 0.5, col = paste0(col,"10") )
  }
  
    y <- exp(predict(model, newdata = list(S_c_fin = x)))
    lines(x, y , col = col, lty = 1, lwd =2, ...)
    text(tail(x,1), tail(y,1), round(label, 2), col = col, pos = 4)
  }

sensitivity_plus <- function(data, label, cols, modeltype = "log") {
     
  par( mar = c(5,3,0.5,1)+.1, oma = c(4,4,2,0), las = 1, lend = 1, bty = "n")
  layout(matrix(c(1:6), ncol = 3, byrow = F))

  longtick = -0.06
  shorttick = -0.03
  par(cex.lab = 1.5)
  
  x <- seq(1,90,length = 100)

  
  # a) Predator biomass
  analyse(webstats$S_c_fin, webstats$meanB_c, equation = FALSE, ylab = "", plotmodel = TRUE, modeltype = modeltype)

  lapply(1:length(data), function(i)  sensitivity_add("meanB_c", data[[i]], label[i], cols[i]))

    axis(2, at = 10^c(-1,0,1), labels = c(0.1, 1, 10), tck = longtick, las = 1)
  axis(2, at = (rep(10^seq(-1, 0, 1), each = 10) * seq(1,10, 1)), labels = NA, tck = shorttick)
   mtext("animal biomass", las = 0, padj = -3,side = 2)
 
  # b) Basal biomass
  analyse(webstats$S_c_fin, webstats$meanB_b, equation = FALSE, ylab = "", plotmodel = TRUE, modeltype = modeltype)
    
  #sensitivity_add("meanB_b", data, label)
  lapply(1:length(data), function(i)  sensitivity_add("meanB_b", data[[i]], label[i], cols[i]))

  axis(1, at = c(0,50,100), tck = longtick)
  axis(1, at = (seq(0,100, 10)), tck = shorttick, labels = NA)
  
 axis(2, at = 10^(-1:1), labels = c(0.1, 1, 10), tck = longtick, las = 1)
  axis(2, at = (rep(10^seq(-1, 0, 1), each = 10) * seq(1,10, 1)), labels = NA, tck = shorttick)
  mtext("plant biomass", las = 0, padj = -3, side = 2)

  
  # c) intra guild predation
  analyse(webstats$S_c_fin[webstats$cons_igp != 0], webstats$cons_igp[webstats$cons_igp != 0], ylab = "", equation = FALSE , plotmodel = TRUE, modeltype = modeltype)
 #analyse(webstats$S_c_fin, (webstats$cons_igp+1), ylab = "", equation = FALSE )
 
  #sensitivity_add("cons_igp", subset(data, cons_igp != 0), label)
  lapply(1:length(data), function(i)  sensitivity_add("cons_igp", subset(data[[i]], cons_igp != 0), label[i], cols[i]))

 axis(2, at = 10^seq(-4,0,2), labels = c(expression(10^{-4}),expression(10^{-2}),expression(10^0)), tck = longtick, las = 1)
  #axis(2, at = 10^seq(-4,0,2),labels = c("0.0001","0.01","1"), tck = longtick, las = 1)
  axis(2, at = (rep(10^seq(-4, -1, 1), each = 10) * seq(1,10, 1)), labels = NA, tck = shorttick)
  mtext("intraguild predation", las = 0, padj = -3, side = 2)
    
  # d) total consumption on basal
  analyse(webstats$S_c_fin, webstats$bas_cons, equation = FALSE, ylab = "", plotmodel = TRUE, modeltype = modeltype)
  
  #sensitivity_add("bas_cons", data, label)
  lapply(1:length(data), function(i)  sensitivity_add("bas_cons", data[[i]], label[i], cols[i]))


  axis(1, at = c(0,50,100), tck = longtick)
  axis(1, at = (seq(0,100, 10)), tck = shorttick, labels = NA)
   
  axis(2, at = 10^c(-1:0), labels = c(0.1, 1), tck = longtick, las = 1)
  axis(2, at = c(seq(0.1,1, 0.1), seq(1,5, 1) ), tck =shorttick, labels = NA)
  mtext("consumption on plants", las = 0, padj = -3, side = 2)
   
  
  # e) Predator respiration
  analyse(webstats$S_c_fin, webstats$cons_resp,equation = FALSE,  ylab = "", plotmodel = TRUE, modeltype = modeltype)
  
  lapply(1:length(data), function(i)  sensitivity_add("cons_resp", data[[i]], label[i], cols[i]))


   axis(2, at = 10^c(-1:0), labels = c(0.1,1),tck = longtick, las = 1)
  axis(2, at = c(seq(.05,0.1, 0.01),seq(.1,1, length = 10)), tck = shorttick , labels = NA)
  mtext("animal respiration", las = 0, padj = -3, side = 2)
  
  # f) Basal respiration
  analyse(webstats$S_c_fin, webstats$bas_resp,equation = FALSE,  ylab = "", plotmodel = TRUE, modeltype = modeltype) # ylim = exp(c(-0.51,1)),
  
  #sensitivity_add("bas_resp", data, label)
  lapply(1:length(data), function(i)  sensitivity_add("bas_resp", data[[i]], label[i], cols[i]))

  axis(1, at = c(0,50,100), tck = longtick)
  axis(1, at = (seq(0,100, 10)), tck = shorttick, labels = NA)
   
  axis(2, at = 10^c(-1:0), labels = c(0.1, 1), tck = longtick, las = 1)
  axis(2, at = c( seq(0.1,1, 0.1), seq(1,5,1)), tck = shorttick , labels = NA)
  mtext("plant respiration", las = 0, padj = -3, side = 2)
  


mtext("Functional Diversity", side = 1, outer = TRUE)
}

```



### Number basal plant species

In the default model, we varied the diversity within the animal community whereas the basal trophic level of plants was initialized with a standardized species richness of 30. This methodology was chosen to ensure that differences in plant productivity such as changes in the total carrying capacity of all basal species cannot confound our results. Allowing extinctions during the population dynamics might further reduce this number in some of the food webs. In the model, the animal species number varied from 10 to 100, which causes very different ratios between the number of animal and plant species. 
The number of plant species might have an impact on the number of animal species that the ecosystem can support and the distribution of the functional diversity along the body mass axis. 
Thus, in this analysis we simulated food webs with 10 and 50 plant species to visualise the effect of the initial number of plant species for the relationship between animal diversity and ecosystem functioning. Increased plant species richness did not alter the patterns qualitatively, but reduced the level of plant biomass while increasing plant respiration rates. Strong effects were visible for low plant species richness which led to reduced plant respiration at high animal diversity and a negative relationship of animal diversity and plant biomass (Fig. S8).
We caution, however, that the model dynamics would also affect the selective survival of animal species in communities with few plants spaced out along the body mass axis. Thus, the animal community is less likely to comprise multiple trophic levels. This illustrates how the reduction of plant diversity propagates up the food chain.

```{r, eval = TRUE, echo = FALSE, dev = 'png', dpi = 300, fig.cap='effect of number of initial plant species, $S_P$, on relationship between FD and ecosystem functions. Red line is the default model with $S_P = 30$; Yellow and blue lines show alternative simulations with low ($S_P = 10$) and high ($S_P = 50$) initial plant species richness, respectively.'}


webstats_Sb10 <- read.table("../data/webstats_Sb10.txt", sep = ",")
webstats_Sb50 <- read.table("../data/webstats_Sb50.txt", sep = ",")


#sensitivity(webstats_Sb$S_b, c(10,50), data = webstats_Sb )
sensitivity_plus(list(webstats_Sb10, webstats_Sb50), label = c(10,50), cols = c("#FFAA00","#0060FF") )


```


### Strict herbivory

The foodwebs constructed by our model assume that most animals are omnivorous feeders that include both plants and animals in their resource spectrum. In nature, many strict herbivores are forming the level of primary consumers, whithout supplementary energy uptake via other pathways. To test how this simplification affects the results of our study, we simulated foodwebs with 50% strict herbivores among the primary consumers, thus strengthening the direct flow of energy into the animal compartment. 

This did reduce plant biomass at high levels of animal species richness, as well as the losses due to plant respiration (Fig. S9). The top-down supression seems to work better in this case. 


```{r,eval = TRUE,  echo = FALSE, dev = 'png', dpi = 300,  fig.cap='effect of pronounced trophic structure by having strict herbivores in the community. Red line is the default model with all animals being omnivores; Blue line show an alternative simulation with 50% of animals strictly limited to herbivorous consumption.'}


webstats_H50 <- read.table("../data/webstats_H50.txt", sep = ",")

sensitivity_plus(data = list(webstats_H50), label=  c(50), cols = c("#0060FF") )


```


### Nutrient supply

To see how bottom-up supply alter the relationship between functional diversity and ecosystem function, we ran the simulation with higher and lower rates of nutrient turnover. 
This changed the absolute values of biomass stocks and consumption and respiration rates, but did not alter the relative change of those values along the gradient of functional diversity (Fig. S 10).

```{r, eval = TRUE, echo = FALSE, dev = 'png', dpi = 300, fig.cap="effect of nutrient supply on relationship between FD and ecosystem functions. Red line is the default model with turnover rate $D = 0.25$; Yellow and blue lines show additional simulations with low ($D = 0.1$) and high ($D = 0.5$) turnover rates, respectively."}


# loop: open files and append to object webstats
webstats_D01 <- read.table("../data/webstats_D01.txt", sep = ",")
webstats_D05 <- read.table("../data/webstats_D05.txt", sep = ",")

sensitivity_plus(list(webstats_D01, webstats_D05), label = c(0.1,0.5), cols = c("#FFAA00","#0060FF") )



```


# References
